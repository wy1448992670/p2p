#{extends 'common/supervisor.html' /}
#{set title:'手动添加' /}
<!-- 内容区域 -->
<div class="xn_c_contentwarp">
	<div class="xn_c_contentlist">
		#{include "supervisor/networkMarketing/CPSSpreadAction/networkMarketingLeft.control"/}
	    <div class="xn_c_content">
	        <div class="xf_content_add">
	            <div class="xfht_t_j_y_2">
	                <!--右上-->
	                <div class="xf_ht_obu_fklm">
	                	手动添加积分
	                </div>
	                <div class="xf_htgl_jgone xf_ht_fff_sz">
	                    <div class="xf_ht_gl_jgone_botton">
	                        <table border="0" cellspacing="0" cellpadding="0" width="50%" a>
	                            <tr>
	                                <td style="text-align: right;">
	                                	请输入手动添加积分：
	                                	<input class="xfht_zr_input" type="text" style="width:80px;" id="score" onkeyup="value=value.replace(/[^\d]/g, '')">
	                                	分
	                                </td>
	                            </tr>
	                            <tr>
	                                <td  style="text-align: right;">
	                                	请输入添加积分对象手机号：
	                                	<input class="xfht_zr_input" type="text" style="width:95px;" id="mobile" 
	                                		onkeyup="value=value.replace(/[^\d]/g, '')" onblur="getUserInfo()">
	                                </td>
	                            </tr>
	                            <tr>
	                                <td style="text-align: right;">
	                                	说明：
	                                	<input class="xfht_zr_input" type="text" style="width:95px;" id="remark" value="参与平台活动">
	                                </td>
	                            </tr>
	                        </table>
	                    </div>
	                     <div id="msg" style="display: none">
	                     <table border="0" cellspacing="0" cellpadding="0" width="50%">
	                    		<input type="hidden" id="user_id" />
	                            <tr>
	                                <td style="text-align: right;">
	                                	无此用户
	                                </td>
	                            </tr>
	                            <tr>
	                            </tr>
	                        </table>
	                     </div>
	                    <div id="user_info" style="display: none">
	                    	<table border="0" cellspacing="0" cellpadding="0" width="50%">
	                    		<input type="hidden" id="user_id" />
	                            <tr>
	                                <td style="text-align: right;">
	                                	用户名：<span id="uname"></span>
	                                </td>
	                            </tr>
	                            <tr>
	                                <td style="text-align: right;">
	                                	真实姓名：<span id="urealname"></span>
	                                </td>
	                            </tr>
	                        </table>
	                    </div>
	                </div>
	                <div class="xf_htgl_jgsix_hyg">
	                    <input class="xf_ht_tcc_button_ok" type="button" onclick="save()" id="xf_dfk_fkzh_tcc3" value="保存">
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
</div>
<script type="text/javascript">
  $(function() {
    showHighLight(8,8,20);
  })
  function save() {
    var score = $("#score").val();
    var mobile = $("#mobile").val();
    var remark = $("#remark").val();
    var userId = $("#user_id").val();
    
    if ("" == score.trim()) {
      alert("请填写积分");
      return;
    }

    if(!checkNumVal(score)){
    	alert("积分必须为数字");
    	return;
    }
    
    if ("" == mobile.trim()) {
       alert("请填写手机号");
       return;
     }

    if ("" == userId.trim()) {
        alert("无效的用户");
        return;
      }
     
    $.ajax({
      url : "@{supervisor.scoreManager.ScoreAction.saveScore()}",
      type : "POST",
      data : {
        "score" : score,
        "mobile" : mobile,
        "remark" : remark,
        "userId" : userId
      },
      success : function(data) {
        alert(data.msg);
        location.reload();
      },
      error : function() {
        alert("对不起，出现错误!");
      }
    });
  }
  
  function getUserInfo(){
	  var mobile = $('#mobile').val();
	  if(mobile.length == 11){
		  $.ajax({
		      url : "@{supervisor.scoreManager.ScoreAction.getUserInfo()}",
		      type : "GET",
		      data : {
		        "mobile" : mobile
		      },
		      success : function(data) {
		    	if(data != null){
		    		 $("#uname").html(data.name);
				     $("#urealname").html(data.reality_name);
				     $("#user_id").val(data.id);
				     $("#user_info").show();
		    	}else{
		    		$("#uname").html('');
				      $("#urealname").html('');
				      $("#user_id").val('');
				      $("#user_info").hide();
				      $("#msg").show();
		    	}
		      },
		      error : function() {
		        //alert("对不起，出现错误!");
		    	  $("#uname").html('');
		    	  $("#user_id").val('');
			      $("#urealname").html('');
			      $("#user_info").hide();
			      $("#msg").show();
		      }
		    });
	  }
  }
  function checkNumVal(res)
  {
	  // 数字校验
      var patrn=/^([1-9]\d*|0)(\.\d*[1-9])?$/;
      var flag = patrn.exec(res);
      if(!flag){
      	return false;
      }else{
    	  return true;
      }
      
  }
</script>