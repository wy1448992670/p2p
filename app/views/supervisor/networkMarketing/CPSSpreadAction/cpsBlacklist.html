#{extends 'common/supervisor.html' /}
#{set title:'CPS黑名单列表' /}
<div class="xfht_t_j_k"> 
<!--左-->
#{include "supervisor/networkMarketing/CPSSpreadAction/networkMarketingLeft.control"/}    
<!--右-->
<div class="xn_c_content">
  <div class="xf_ht_tablelist">
  #{form @supervisor.networkMarketing.CPSSpreadAction.cpsBlacklist(), id:'submit'}
  <input type="hidden" id="currPage" name="currPage"/>
  <input type="hidden" id="pageSize" name="pageSize"/>
  <!-- 搜索 -->
  <div class="xf_ht_search">
      <div class="xf_ht_search_l">
        <span id="div_0" class="xf_sea_isshow">默认排序</span>
      </div>
     </div>
     <div class="xf_ht_search_inon">
       <div class="xf_ht_search_r">
         <div class="xf_ht_search_xl">
           <input name="keyword" type="text" class="search_w"  value="${page?.conditions?.keyword}" placeholder="手机号/用户名/真实姓名"/>
         </div>
         <div class="xf_ht_search_xl">
           <input type="submit" class="search_button" value="搜索">
         </div>
       </div>
     </div>
     #{/form}
	<!-- 列表内容 -->
	<div class="xn_c_content_top">
      #{table class:"xn_c_content_list",cellspacing:"0",cellpadding:"0",border:"0",tr_class_odd:"xn_tr_bj"}
        #{tr}
          #{th}序号#{/th}
          #{th}用户名#{/th}
          #{th}真实姓名#{/th}
          #{th}手机号#{/th}
          #{th}操作#{/th}
        #{/tr}
        #{list page?.page}
        #{tr tr_index:_index}
          #{td}${(page?.currPage - 1) * page?.pageSize + _index}#{/td}
          #{td}${_?.name}#{/td}
          #{td}${_?.reality_name}#{/td}
          #{td}${_?.mobile}#{/td}
          #{td}<span class="xf_ta_onclick" onClick="remove('${_?.id}', 0)">移除</span>#{/td}
        #{/tr}
        #{/list}
      #{/table}
    </div>
    <!-- 列表底部 -->
    <div class="xn_c_content_bottom">
	    <button type="button" onclick="selectUsersInit(1,10)" class="search_button">添加</button>
        <div class="page_warp">
          #{page currPage:page.currPage,totalCount:page.totalCount,pageSize:page.pageSize,theme:2,style:4/}
        </div>
    </div>
  </div>
</div>
</div>

<!--选择会员-弹出层 -->
<div id="xf_ht_xzhy_ttc"></div>
<style><!--
.xselect:hover{border-top:1px solid #EEE;border-bottom:1px solid #EEE;cursor: pointer;background-color: #f8f8f8;}
--></style>
<script type="text/javascript">
$(function(){
  //高亮显示
  showHighLight(1,1,4);
});

		
function showPage(currPage, pageSize){
    $("#currPage").val(currPage);
    $("#pageSize").val(pageSize);
    $("#submit").submit();
}

function remove(id, isBlack){
	var msg = isBlack == 1 ? "确定加入黑名单吗?" : "确定移除吗?";
	if(!confirm(msg)){
		return;
	}
	$.post("/supervisor/CPSSpreadAction/cpsBlacklist", {"userId":id, "isBlacklist": isBlack}, function(result){
		try{
			if(isBlack == 0 && result == 1){
				alert("移除成功")
			}else if(isBlack == 1){
				if(result == 1){
					alert("添加成功")
				}else{
					alert("已添加")
				}
			}else{
				alert("系统错误, 请稍候重试!");
			}
			location.reload();
		}catch(e){
			alert("系统错误, 请稍候重试!");
		}
	});
}

//显示选择用户弹窗
function selectUsersInit(currPage, pageSize) {
	  
	 // if(overSendUserNum())return;
	 g_selectedNames = new Array();
  $.ajax({
    url : "@{supervisor.webContentManager.Message.selectUsersInit()}",
    type : "POST",
    data : {
      "currPage" : currPage,
      "pageSize" : pageSize,
      "keyword" : $("#keyword").val(),
      "beginTime":$("#beginTime").val(),
      "endTime":$("#endTime").val(),
      "orderType":$("#orderType").val(),
      "radio":1
    },
    success : function(data) {
      if (data.code < 0) {
        alert(data.msg);

        return;
      }

      var ttc = $("#xf_ht_xzhy_ttc");
      ttc.html(data);
      var index =$.layer({
        type: 1,
        area: ['1000px', '600px'],
        title: '选择会员',
        page: {dom : '#xf_ht_xzhy_ttc'}
      });
      if(index > 1){
        index = index - 1;
        $("#xubox_shade"+index).remove();
      }
      
      $(".xselect").on("click", function(){
    	  	remove($(this).attr("uid"), 1);
      });
    },
    error : function() {
      alert("对不起，出现错误!");
    }
  });
}
</script>